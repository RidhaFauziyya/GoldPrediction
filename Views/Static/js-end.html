<!-- bootstrap js -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>

<script>
    var base_url_api = 'http://127.0.0.1:5000/api';
    $(document).ready( function () {
        // create chart
        create_gold_histories_hart()

        // create table
        const predictionTable = $("div#prediction-histories").Grid({
            columns: ['Name', 'Age', 'Email'],
            pagination: {
                limit: 5
            },
            data: [
                ['John', 25, 'john@k.com'],
                ['Mark', 59, 'mark@e.com'],
            ]
        });

        // on click listeners
        $('#submit-prediction').click(function(){
            updateTable(predictionTable)
        });

    });

    function populateTable(params) {
        var url = `${base_url_api}/update_gold_data`;
        $.get(url).then(function (res) {
            params.success(res)
        })
    }

    function addData(chart, label, newData) {
        chart.data.labels.push(label);
        chart.data.datasets.forEach((dataset) => {
            dataset.data.push(newData);
        });
        chart.update();
    }

    function removeData(chart) {
        chart.data.labels.pop();
        chart.data.datasets.forEach((dataset) => {
            dataset.data.pop();
        });
        chart.update();
    }

    function ajax_call(endpoint, method) {
        $.ajax({
            type: "GET",
            url: endpoint,
            success: function(data) {
                return data
            }
        });
    }

    function create_gold_histories_hart() {
        $.ajax({
            type: "GET",
            url: `${base_url_api}/chart/get_gold_data`,
            success: function(data) {
                // get date and close price data
                let date_data = data['response']['date_data'];
                let close_data = data['response']['close_data'];

                // draw chart from data
                let ctx = document.getElementById('historical-gold-data-chart');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                    labels: date_data,
                    datasets: [{
                            label: 'Gold Price in USD',
                            data: close_data,
                            borderColor: 'rgba(66, 54, 23)',
                            backgroundColor: 'rgba(222, 192, 115)',
                            borderWidth: 2,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            x: {
                                title: {
                                display: true,
                                text: 'Date'
                                }
                            },
                            y: {
                                title: {
                                display: true,
                                text: 'Price'
                                },
                                beginAtZero: false
                            }
                        }
                    }
                });
            }
        });
    }

    function updateTable(table) {
        Swal.fire({
            icon: "success",
            title: "Your work has been saved",
            showConfirmButton: false,
            timer: 1500
        });
        table.updateConfig({
            data: [
                ["test", "test@example.com", "(353) 01 222 3333"],
                ["Mark", "mark@gmail.com", "(01) 22 888 4444"],
                ["Eoin", "eoin@gmail.com", "0097 22 654 00033"],
                ["Sarah", "sarahcdd@gmail.com", "+322 876 1233"],
                ["Afshin", "afshin@mail.com", "(353) 22 87 8356"]
            ]
        }).forceRender();
    }
</script>